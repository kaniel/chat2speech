version: '2'
services:
    chat2speech-rabbit:
        container_name: chat2speech-rabbit
        image: rabbitmq:3.6-management
        restart: always
        environment:
            - RABBITMQ_DEFAULT_USER=guest
            - RABBITMQ_DEFAULT_PASS=guest
            - RABBITMQ_DEFAULT_VHOST=/
        volumes:
            - ./data/rabbitmq-mnesia:/var/lib/rabbitmq/mnesia/
        expose:
            - 5672
            - 15672
            - 12397
        ports:
            - "5672:5672"
            - "15672:15672"
    chat2speech-app:
        container_name: chat2speech-app
        image: khilnani/pythonlite:latest
        depends_on:
            - chat2speech-rabbit
        restart: always
        environment:
            - ENV=production
            - PORT=8080
            - RABBITMQ_USER=guest
            - RABBITMQ_PASSWORD=guest
            - RABBITMQ_HOST=chat2speech-rabbit
            - RABBITMQ_VHOST=/
        volumes:
            - .:/opt/chat2speech
        expose:
            - 8080
            - 5000
        ports:
            - "8080:8080"
        entrypoint: /bin/sh /opt/chat2speech/env/entrypoint-app.sh
